---
title: 브라우저 팝업차단 문제 해결하기
date: 2021-01-02
description: 브라우저 팝업차단을 해결하는 방법들을 정리합니다.
tags:
  - 프론트엔드
---

일주일 전에 기능을 개선했었는데, 크롬에서 잘 되는지 확인하고 난 후 다른 브라우저를 제대로 확인하지 않았었습니다.

그랬더니 팝업 차단 문제 때문에 고객분들께 문의가 많이 들어왔다고 하네요..ㅠㅠ(모바일 사파리의 경우 팝업 차단 관련된 문제가 참 복잡하더군요)

확인해보니, window.open()이 onClick 이벤트 핸들러의 스코프 내에 존재하지 않거나, 핸들러에 비동기 작업이 포함되어 있거나.. 이런 경우에 브라우저가 팝업을 차단하고 있었습니다.

아무래도 사용자가 의도한 것이 아니라면 다른 도메인에 속한 페이지의 팝업은 열리지 않도록 만든 것 같네요.

```typescript
// 이런 경우에 차단됨
const outlink = async () => {
  const url = await getUrl();
  window.open(url);
};

return (
  <button
    onClick={() => {
      outlink();
    }}
  />
);
```

```typescript
// 이런 식으로 해야 잘 동작
return (
  <button
    onClick={() => {
      window.open(url);
    }}
  />
);
```

## 추가

회사 동료분의 코드리뷰로부터 더 괜찮아 보이는 방법을 알게됬네요!

팝업 차단은 단순한 순서 변경으로도 우회가 가능하다고 합니다.

#### 기존 순서

1. API call을 통해 URL을 얻어옴
2. 그 URL로 팝업 열어서 이동
3. 팝업이 차단됨

#### 팝업 차단 우회 방법

1. 빈 팝업을 먼저 열음 (window.open의 반환값인 child window를 변수로 받아놓음)
2. API call을 통해 URL을 얻어옴
3. 그 URL을 사용해 아까 받아둔 window의 location을 설정함
4. 정상 동작
